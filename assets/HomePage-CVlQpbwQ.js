import{c as v,_ as u,L as O,o as r,a as d,b as f,r as a,d as t,t as m,F as y,e as $,n as P,f as S,g as F,h as g,w as N,i as b,j as B,k as L}from"./index-C4icjzTI.js";const U=e=>v.get(`/posts?userId=${e}`),D=(e,s,n)=>v.post("/posts",{userId:e,title:s,body:n}),H=(e,s,n)=>v.patch(`/posts/${e}`,{title:s,body:n}),Y=e=>v.delete(`/posts/${e}`),j={name:"PostLoader",components:{LoaderSpiner:O}},q={class:"is-flex is-justify-content-center is-align-items-center mt-2"};function z(e,s,n,h,o,i){const l=a("LoaderSpiner");return r(),d("div",q,[f(l)])}const k=u(j,[["render",z]]),W={name:"HeaderComponent",props:{userName:String},methods:{handleLogout(){localStorage.removeItem("user"),this.$router.push({path:"/login"})}}},G={class:"navbar",role:"navigation","aria-label":"main navigation"},J=t("div",{class:"navbar-item"},[t("h1",{class:"is-size-4"},"Vue List Of Posts")],-1),K={class:"navbar-end"},Q={class:"navbar-item"},R={class:"buttons"},X={class:"mr-5 mb-2"};function Z(e,s,n,h,o,i){return r(),d("nav",G,[J,t("div",K,[t("div",Q,[t("div",R,[t("div",X,[t("p",null,"User: "+m(n.userName),1)]),t("a",{class:"button is-light",onClick:s[0]||(s[0]=(...l)=>this.handleLogout&&this.handleLogout(...l))}," Logout ")])])])])}const ee=u(W,[["render",Z]]),te={name:"HeaderComponent",emits:["set-opened-post-id"],props:{posts:Array,openedPostId:Number},methods:{toggleOpenSidebar(e){this.$emit("set-opened-post-id",e)},buttonText(e){return this.openedPostId===e?"Close":"Open"}}},se={class:"table is-fullwidth is-striped is-hoverable is-narrow"},oe=t("thead",null,[t("tr",{class:"has-background-link-light"},[t("th",null,"ID"),t("th",null,"Title"),t("th",{class:"has-text-right"},"Actions")])],-1),ne={class:"has-text-right is-vcentered"},ie=["onClick"];function re(e,s,n,h,o,i){return r(),d("table",se,[oe,t("tbody",null,[(r(!0),d(y,null,$(n.posts,({id:l,title:C})=>(r(),d("tr",{key:l},[t("td",null,m(l),1),t("td",null,m(C),1),t("td",ne,[t("button",{type:"button",class:P(["button is-link",{"is-light":n.openedPostId!==l}]),onClick:c=>i.toggleOpenSidebar(l)},m(i.buttonText(l)),11,ie)])]))),128))])])}const le=u(te,[["render",re]]),de={name:"MessageComponent",emits:["hide"],props:{active:Boolean},methods:{hideMessage(){this.$emit("hide")}}},ae={class:"message-header"},me=t("p",null,"Error",-1),ce={class:"message-body"};function he(e,s,n,h,o,i){return r(),d("article",{class:P(["message is-danger is-small",{"message--hidden":!n.active}])},[t("div",ae,[me,t("button",{class:"delete",onClick:s[0]||(s[0]=(...l)=>i.hideMessage&&i.hideMessage(...l))})]),t("div",ce,[S(e.$slots,"default",{},()=>[F("Something wrong")])])],2)}const A=u(de,[["render",he]]),ue={name:"SidebarComponent",props:{active:Boolean}},pe={class:"tile is-child box is-success"},_e={class:"content"};function ge(e,s,n,h,o,i){return r(),d("div",{class:P(["tile is-parent is-8-desktop Sidebar",n.active?"Sidebar--open":""])},[t("div",pe,[t("div",_e,[S(e.$slots,"default")])])],2)}const fe=u(ue,[["render",ge]]),be={name:"InputField",props:{title:String,inputName:String,errorMessage:String,placeholder:String,modelValue:String,type:String},emits:["update:modelValue"]},Ce={class:"field"},Pe=["htmlFor"],ye={class:"control has-icons-left has-icons-right"},ve=["type","name","id","placeholder","value"],Ie={class:"icon is-small is-left"},Me={key:0,class:"icon is-small is-right has-text-danger"},Ne=t("i",{class:"fas fa-exclamation-triangle"},null,-1),ke=[Ne],Ae={key:0,class:"help is-danger"};function $e(e,s,n,h,o,i){return r(),d("div",Ce,[t("label",{class:"label",htmlFor:`comment-author-name-${n.inputName}`},m(n.title),9,Pe),t("div",ye,[t("input",{type:n.type,class:P(["input",{"is-danger":n.errorMessage}]),name:n.inputName,id:`comment-author-name-${n.inputName}`,placeholder:n.placeholder,value:n.modelValue,onInput:s[0]||(s[0]=l=>e.$emit("update:modelValue",l.target.value))},null,42,ve),t("span",Ie,[t("i",{class:P(["fas",n.type==="email"?"fa-envelope":"fa-user"])},null,2)]),n.errorMessage?(r(),d("span",Me,ke)):g("",!0)]),n.errorMessage?(r(),d("p",Ae,m(n.errorMessage),1)):g("",!0)])}const x=u(be,[["render",$e]]),Se={name:"TextAreaField",props:{title:String,inputName:String,errorMessage:String,placeholder:String,modelValue:String},emits:["update:modelValue"]},Be={class:"field","data-cy":"BodyField"},xe=["htmlFor"],Te={class:"control"},Ee=["id","name","placeholder","value"],Ve={key:0,class:"help is-danger"};function we(e,s,n,h,o,i){return r(),d("div",Be,[t("label",{class:"label",htmlFor:`comment-${n.inputName}`},m(n.title),9,xe),t("div",Te,[t("textarea",{id:`comment-${n.inputName}`,name:n.inputName,placeholder:n.placeholder,class:P(["textarea",{"is-danger":n.errorMessage}]),value:n.modelValue,onInput:s[0]||(s[0]=l=>e.$emit("update:modelValue",l.target.value))},null,42,Ee)]),n.errorMessage?(r(),d("p",Ve,m(n.errorMessage),1)):g("",!0)])}const T=u(Se,[["render",we]]),Oe={name:"AddPost",components:{InputField:x,TextAreaField:T,MessageComponent:A,PostLoader:k},emits:["close","add-post","post-updated"],props:{title:String,userId:Number,postToEdit:Object||void 0},data(){return{newTitle:this.postToEdit?this.postToEdit.title:"",errorTitle:"",errorPostBody:"",postBody:this.postToEdit?this.postToEdit.body:"",errorMessage:"",loading:!1}},computed:{buttonText(){return this.postToEdit?"Save":"Create"}},watch:{newTitle:{handler(){this.errorTitle&&(this.errorTitle="")}},postBody:{handler(){this.errorPostBody&&(this.errorPostBody="")}}},methods:{handlerCloseSidebar(){this.$emit("close")},handlerSubmit(){this.errorMessage="",this.newTitle=this.newTitle.trim(),this.postBody=this.postBody.trim(),this.newTitle||(this.errorTitle="Title is required"),this.postBody||(this.errorPostBody="Body is required"),!(this.errorTitle||this.errorPostBody)&&(this.loading=!0,this.postToEdit?H(this.postToEdit.id,this.newTitle,this.postBody).then(({data:e})=>{this.$emit("post-updated",e)}).catch(()=>{this.errorMessage="Unable to update post"}).finally(()=>{this.loading=!1}):D(this.userId,this.newTitle,this.postBody).then(({data:e})=>{this.$emit("add-post",e)}).catch(()=>{this.errorMessage="Unable to create post"}).finally(()=>{this.loading=!1}))}}},Fe={class:"content"},Le={class:"field is-grouped"},Ue={class:"control"},De={type:"submit",class:"button is-link"},He={class:"control"};function Ye(e,s,n,h,o,i){const l=a("MessageComponent"),C=a("PostLoader"),c=a("InputField"),M=a("TextAreaField");return r(),d("div",Fe,[t("h2",null,m(n.title),1),f(l,{active:o.errorMessage!=="",onHide:s[0]||(s[0]=p=>o.errorMessage="")},{default:N(()=>[t("p",null,m(o.errorMessage),1)]),_:1},8,["active"]),o.loading?(r(),b(C,{key:0})):(r(),d("form",{key:1,onSubmit:s[4]||(s[4]=B((...p)=>i.handlerSubmit&&i.handlerSubmit(...p),["prevent"]))},[f(c,{title:"Title",inputName:"title",placeholder:"Post title",errorMessage:o.errorTitle,type:"text",modelValue:o.newTitle,"onUpdate:modelValue":s[1]||(s[1]=p=>o.newTitle=p)},null,8,["errorMessage","modelValue"]),f(M,{title:"Write Post Body",inputName:"post-body",placeholder:"Post body",errorMessage:o.errorPostBody,modelValue:o.postBody,"onUpdate:modelValue":s[2]||(s[2]=p=>o.postBody=p)},null,8,["errorMessage","modelValue"]),t("div",Le,[t("div",Ue,[t("button",De,m(i.buttonText),1)]),t("div",He,[t("button",{type:"reset",class:"button is-link is-light",onClick:s[3]||(s[3]=(...p)=>i.handlerCloseSidebar&&i.handlerCloseSidebar(...p))}," Cancel ")])])],32))])}const je=u(Oe,[["render",Ye]]),qe=e=>v.get(`/comments?postId=${e}`),ze=(e,s,n,h)=>v.post("/comments",{postId:e,name:s,email:n,body:h}),We=e=>v.delete(`/comments/${e}`),Ge={name:"AddComment",components:{InputField:x,TextAreaField:T},emits:["close","add-comment","error"],props:{postId:Number,name:String,email:String},data(){return{loading:!1,authorName:this.name,authorEmail:this.email,commentBody:"",errorAauthorName:"",errorAuthorEmail:"",errorCommentBody:""}},watch:{authorName:{handler(){this.errorAauthorName&&(this.errorAauthorName="")}},authorEmail:{handler(){this.authorEmail&&(this.errorAuthorEmail="")}},commentBody:{handler(){this.commentBody&&(this.errorCommentBody="")}}},methods:{handlerCloseAddCommentForm(){this.$emit("close")},handlerSubmit(){this.$emit("error",""),this.authorName=this.authorName.trim(),this.authorEmail=this.authorEmail.trim(),this.commentBody=this.commentBody.trim(),this.authorName||(this.errorAauthorName="Author Name is required"),this.authorEmail||(this.errorAuthorEmail="Author Email is required"),this.commentBody||(this.errorCommentBody="Comment Body is required"),!(this.errorAauthorName||this.errorAuthorEmail||this.errorCommentBody)&&(this.loading=!0,ze(this.postId,this.authorName,this.authorEmail,this.commentBody).then(({data:e})=>{this.$emit("add-comment",e),this.$emit("close")}).catch(()=>{this.$emit("error","Unable to create comment")}).finally(()=>{this.loading=!1}))}}},Je={class:"field is-grouped"},Ke={class:"control"},Qe=["disabled"],Re={class:"control"};function Xe(e,s,n,h,o,i){const l=a("InputField"),C=a("TextAreaField");return r(),d("form",{onSubmit:s[4]||(s[4]=B((...c)=>i.handlerSubmit&&i.handlerSubmit(...c),["prevent"]))},[f(l,{title:"Author Name",inputName:"author-name",placeholder:"Name Surname",type:"text",errorMessage:o.errorAauthorName,modelValue:o.authorName,"onUpdate:modelValue":s[0]||(s[0]=c=>o.authorName=c)},null,8,["errorMessage","modelValue"]),f(l,{title:"Author Email",inputName:"author-email",placeholder:"Your Email",type:"email",errorMessage:o.errorAuthorEmail,modelValue:o.authorEmail,"onUpdate:modelValue":s[1]||(s[1]=c=>o.authorEmail=c)},null,8,["errorMessage","modelValue"]),f(C,{title:"Write Comment Body",inputName:"comment-body",placeholder:"Your comment",errorMessage:o.errorCommentBody,modelValue:o.commentBody,"onUpdate:modelValue":s[2]||(s[2]=c=>o.commentBody=c)},null,8,["errorMessage","modelValue"]),t("div",Je,[t("div",Ke,[t("button",{type:"submit",class:P(["button is-link",{"is-loading":o.loading}]),disabled:o.loading}," Add Comment ",10,Qe)]),t("div",Re,[t("button",{type:"reset",class:"button is-link is-light",onClick:s[3]||(s[3]=(...c)=>i.handlerCloseAddCommentForm&&i.handlerCloseAddCommentForm(...c))}," Cancel ")])])],32)}const Ze=u(Ge,[["render",Xe]]),et={name:"CommentComponent",emits:["delete"],props:{comment:Object},computed:{mailto(){return`mailto:${this.comment.email}`}},methods:{handlerDeleteComment(e){this.$emit("delete",e)}}},tt={class:"message is-small"},st={class:"message-header"},ot=["href"],nt={class:"message-body"};function it(e,s,n,h,o,i){return r(),d("article",tt,[t("div",st,[t("a",{href:i.mailto},m(n.comment.name),9,ot),t("button",{type:"button",class:"delete is-small","aria-label":"delete",onClick:s[0]||(s[0]=l=>i.handlerDeleteComment(n.comment.id))}," delete button ")]),t("div",nt,m(n.comment.body),1)])}const rt=u(et,[["render",it]]),lt={name:"NoCommentsYet",props:{text:String}},dt={class:"block"},at={class:"title is-4"};function mt(e,s,n,h,o,i){return r(),d("div",dt,[t("p",at,m(`No ${n.text} yet`),1)])}const E=u(lt,[["render",mt]]),ct={name:"PostPreview",components:{AddComment:Ze,MessageComponent:A,PostLoader:k,NoCommentsYet:E,CommentComponent:rt},emits:["delete","edit-post"],props:{post:Object},data(){return{loading:!1,errorMessage:"",comments:[],visibleComments:[],addCommentsIsOpen:!1,authorName:"",authorEmail:""}},mounted(){this.errorMessage="",this.loading=!0,qe(this.post.id).then(({data:e})=>{this.comments=e,this.visibleComments=e}).catch(()=>{this.errorMessage="Unable to load comments"}).finally(()=>{this.loading=!1})},methods:{toggleAddCommentsIsOpen(){this.addCommentsIsOpen=!this.addCommentsIsOpen},handlerAddComment(e){this.comments=[...this.comments,e],this.visibleComments=this.comments,this.authorName=e.name,this.authorEmail=e.email},handlerDeleteComment(e){this.errorMessage="",this.visibleComments=this.comments.filter(s=>s.id!==e),We(e).then(()=>{this.comments=this.visibleComments}).catch(()=>{this.errorMessage="Unable to delete comments",this.visibleComments=this.comments})}}},ht={class:"block"},ut={class:"is-flex is-justify-content-space-between is-align-items-center"},pt={class:"is-flex"},_t=t("i",{class:"fas fa-pen-to-square"},null,-1),gt=[_t],ft=t("i",{class:"fas fa-trash"},null,-1),bt=[ft],Ct={"data-cy":"PostBody"};function Pt(e,s,n,h,o,i){const l=a("MessageComponent"),C=a("PostLoader"),c=a("CommentComponent"),M=a("NoCommentsYet"),p=a("AddComment");return r(),d("div",ht,[t("div",ut,[t("h2",null,m(`#${n.post.id}: ${n.post.title}`),1),t("div",pt,[t("span",{class:"icon is-small is-right is-clickable",onClick:s[0]||(s[0]=_=>e.$emit("edit-post"))},gt),t("span",{class:"icon is-small is-right has-text-danger is-clickable ml-3",onClick:s[1]||(s[1]=_=>e.$emit("delete"))},bt)])]),t("p",Ct,m(n.post.body),1),f(l,{active:o.errorMessage!=="",onHide:s[2]||(s[2]=_=>o.errorMessage="")},{default:N(()=>[t("p",null,m(o.errorMessage),1)]),_:1},8,["active"]),o.addCommentsIsOpen?g("",!0):(r(),d(y,{key:0},[o.loading?(r(),b(C,{key:0})):(r(),d(y,{key:1},[o.errorMessage?g("",!0):(r(!0),d(y,{key:0},$(o.visibleComments,_=>(r(),b(c,{key:_.id,comment:_,onDelete:i.handlerDeleteComment},null,8,["comment","onDelete"]))),128)),!o.errorMessage&&o.visibleComments.length===0?(r(),b(M,{key:1,text:"comments"})):g("",!0),o.errorMessage?g("",!0):(r(),d("button",{key:2,type:"button",class:"button is-link",onClick:s[3]||(s[3]=(..._)=>i.toggleAddCommentsIsOpen&&i.toggleAddCommentsIsOpen(..._))}," Write a comment "))],64))],64)),o.addCommentsIsOpen?(r(),b(p,{key:1,postId:n.post.id,name:this.authorName,email:this.authorEmail,onClose:i.toggleAddCommentsIsOpen,onAddComment:i.handlerAddComment,onError:s[4]||(s[4]=_=>o.errorMessage=_)},null,8,["postId","name","email","onClose","onAddComment"])):g("",!0)])}const yt=u(ct,[["render",Pt]]),vt={name:"HomePage",components:{HeaderComponent:ee,PostLoader:k,PostList:le,MessageComponent:A,SidebarComponent:fe,AddPost:je,PostPreview:yt,NoCommentsYet:E},data(){return{loading:!1,errorMessage:"",posts:[],user:L(),sidebarIsOpen:!1,openedPostId:null,editingPost:null,addingPost:!1}},mounted(){this.errorMessage="",this.loading=!0,U(this.user.id).then(({data:e})=>{this.posts=e}).catch(()=>{this.errorMessage="Unable to load posts"}).finally(()=>{this.loading=!1})},methods:{handlerAddNewPost(){this.addingPost=!0,this.openedPostId=null,this.sidebarIsOpen||(this.sidebarIsOpen=!0)},handlerCloseSidebar(){this.editingPost?this.openedPostId=this.editingPost.id:(this.sidebarIsOpen=!1,this.openedPostId=null),this.addingPost=!1,this.editingPost=null},setOpenedPostId(e){this.addingPost=!1,e===this.openedPostId?(this.sidebarIsOpen=!1,this.openedPostId=null):this.openedPostId===null?(this.sidebarIsOpen=!0,this.openedPostId=e):e!==this.openedPostId&&this.openedPostId!==null&&(this.openedPostId=e)},handlerAddPost(e){this.posts=[...this.posts,e],this.openedPostId=e.id,this.addingPost=!1},handlerDeletePost(){this.sidebarIsOpen=!1,this.loading=!0,Y(this.openedPostId).then(()=>{this.posts=this.posts.filter(e=>e.id!==this.openedPostId)}).catch(()=>{this.errorMessage="Unable to delete post"}).finally(()=>{this.loading=!1,this.openedPostId=null})},handlerEditPost(){this.editingPost=this.posts.find(e=>e.id===this.openedPostId),this.openedPostId=null,this.addingPost=!0},postUpdated(e){this.openedPostId=e.id,this.addingPost=!1,this.posts=this.posts.map(s=>s.id===e.id?e:s),this.editingPost=null}}},It={class:"section"},Mt={class:"container"},Nt={class:"tile is-ancestor"},kt={class:"tile is-parent"},At={class:"tile is-child box is-success"},$t={class:"block"},St={class:"block is-flex is-justify-content-space-between"},Bt=t("h2",{class:"is-size-3"},"Posts",-1);function xt(e,s,n,h,o,i){const l=a("HeaderComponent"),C=a("MessageComponent"),c=a("PostLoader"),M=a("PostList"),p=a("NoCommentsYet"),_=a("AddPost"),V=a("PostPreview"),w=a("SidebarComponent");return r(),d(y,null,[t("header",null,[f(l,{userName:o.user.name},null,8,["userName"])]),t("main",It,[t("div",Mt,[t("div",Nt,[t("div",kt,[t("div",At,[t("div",$t,[t("div",St,[Bt,t("button",{type:"button",class:P(["button is-link",{"is-light":o.addingPost}]),onClick:s[0]||(s[0]=(...I)=>i.handlerAddNewPost&&i.handlerAddNewPost(...I))}," Add New Post ",2)]),f(C,{active:o.errorMessage!=="",onHide:s[1]||(s[1]=I=>o.errorMessage="")},{default:N(()=>[t("p",null,m(o.errorMessage),1)]),_:1},8,["active"]),o.loading?(r(),b(c,{key:0})):(r(),d(y,{key:1},[o.errorMessage?g("",!0):(r(),d(y,{key:0},[o.posts.length>0?(r(),b(M,{key:0,posts:o.posts,openedPostId:o.openedPostId,onSetOpenedPostId:s[2]||(s[2]=I=>i.setOpenedPostId(I))},null,8,["posts","openedPostId"])):(r(),b(p,{key:1,text:"posts"}))],64))],64))])])]),f(w,{active:o.sidebarIsOpen},{default:N(()=>[o.addingPost?(r(),b(_,{key:0,title:o.editingPost?"Post editing":"Create new post",postToEdit:o.editingPost,userId:o.user.id,onClose:i.handlerCloseSidebar,onAddPost:i.handlerAddPost,onPostUpdated:i.postUpdated},null,8,["title","postToEdit","userId","onClose","onAddPost","onPostUpdated"])):g("",!0),o.openedPostId?(r(),b(V,{post:o.posts.find(I=>I.id===o.openedPostId),onDelete:i.handlerDeletePost,onEditPost:i.handlerEditPost,key:o.openedPostId},null,8,["post","onDelete","onEditPost"])):g("",!0)]),_:1},8,["active"])])])])],64)}const Et=u(vt,[["render",xt]]);export{Et as default};
